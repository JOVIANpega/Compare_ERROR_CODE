# Error Code Comparer v1.5.0 (Build 1)

這是一個用於比對 Error Code 的工具，可以將 Excel 文件中的 Error Code 與參考文件進行比對，並生成新的比對結果文件。

## 版本資訊

- **當前版本**：v1.5.0 (Build 1)
- **發布日期**：2025-01-22
- **作者**：JOVIANpega
- **倉庫**：[https://github.com/JOVIANpega/Compare_ERROR_CODE](https://github.com/JOVIANpega/Compare_ERROR_CODE)
- **描述**：智能錯誤碼比對工具，支援 AI 推薦分析

## 功能特點

### 核心功能
- **智能錯誤碼比對**：支援多種 Error Code 格式的比對（BSF 系列、E00 系列）
- **Excel 檔案處理**：自動讀取和處理 Excel 檔案，支援多工作表操作
- **智能標題行檢測**：自動識別 Excel 檔案的標題行，避免 "Unnamed" 欄位問題
- **結果檔案生成**：自動生成包含比對結果的新 Excel 檔案

### AI 智能功能
- **AI 推薦分析**：基於 Description 自動推薦最適合的 Test ID
- **智能關鍵字匹配**：使用錯誤碼查詢邏輯進行精準匹配
- **自動比對流程**：如果沒有現有比對結果，會自動執行比對後再進行 AI 推薦
- **雙重推薦**：提供兩個最適合的 Test ID 推薦（E、F 欄位）

### 用戶體驗優化
- **狀態列顯示**：即時顯示操作進度和結果狀態
- **進度條顯示**：比對和 AI 推薦過程都有詳細的進度條和步驟顯示
- **自動檔案選擇**：啟動時自動搜尋並選擇 Test Item Code 文件
- **智能工作表過濾**：自動排除 properties、DUTs、Switch、Instrument 等工作表
- **快速開啟結果檔案**：一鍵開啟比對結果檔案，支援多檔案選擇
- **錯誤碼查詢工具**：獨立的錯誤碼查詢視窗，支援關鍵字搜尋
- **覆蓋檔案選項**：Checkbox 控制是否覆蓋現有比對檔案，預設打勾
- **檔案記憶功能**：自動記住上次使用的檔案路徑，下次啟動時自動載入

### 系統管理
- **版本管理系統**：完整的版本控制和變更記錄管理
- **配置管理**：自動保存和載入用戶設定
- **檔案搜尋優化**：修復檔案搜尋重複問題，提升搜尋效率
- **專案結構優化**：清晰的檔案分類和目錄結構

## 使用方法

### 基本比對功能
1. 運行 ErrorCodeComparer.exe
2. **自動選擇 Error Code 文件**：程式會自動搜尋並選擇 Test Item Code 文件
3. 點擊 "Browse" 選擇源 Excel 文件
4. **自動載入工作表**：選擇 Excel 文件後會自動載入所有工作表
5. **智能工作表過濾**：自動排除 properties、DUTs、Switch、Instrument 等不需要的工作表
6. **預設選擇第一個工作表**：自動選擇第一個有效的工作表（如 FWDL）
7. **覆蓋檔案選項**：勾選 "覆蓋比對檔案" 可避免重複確認對話框
8. 點擊 "Compare" 開始比對
9. **進度條顯示**：比對過程中會顯示詳細的進度步驟
10. 比對完成後，會在源文件相同目錄下生成新的 Excel 文件

### AI 推薦分析功能
1. 完成基本比對後，點擊 "AI推薦分析" 按鈕
2. **進度條顯示**：AI 推薦過程中會顯示詳細的進度步驟
3. **自動比對檢查**：如果沒有現有比對結果，系統會自動執行比對
4. 系統會自動分析 Description 並推薦最適合的 Test ID
5. **格式保持**：推薦結果會自動填入 E、F 欄位，完全保持原有 Excel 格式
6. 推薦結果會自動填入 E、F 欄位（AI推薦 test ID 1、AI推薦 test ID 2）
7. 如果沒有現有比對結果，系統會顯示 PROMPT 供手動處理

### 錯誤碼查詢功能
1. 點擊 "錯誤碼查詢" 按鈕開啟查詢視窗
2. **自動載入檔案**：系統會自動載入上次使用的 Excel 檔案
3. **智能檔案讀取**：自動處理 Excel 檔案的標題行，避免 "Unnamed" 欄位
4. **多關鍵字搜尋**：支援同時輸入多個關鍵字進行 AND 條件搜尋
5. **即時狀態顯示**：狀態列會顯示檔案載入、搜尋進度等資訊
6. **右鍵複製功能**：點擊結果行可右鍵複製 Interface 欄位內容
7. **清除搜尋**：使用清除按鈕快速重置搜尋條件
8. **視窗控制**：支援最大化、最小化，預設最大化顯示

### 狀態列功能
主 GUI 底部提供即時狀態顯示：
- **藍色**：正常狀態（就緒）
- **橙色**：進行中狀態（比對、AI 推薦、檔案讀取）
- **綠色**：成功狀態（完成）
- **紅色**：錯誤狀態（失敗）

狀態列會顯示：
- 當前操作進度
- 檔案路徑資訊
- 操作結果摘要
- 錯誤訊息提示

### 進度條功能
比對和 AI 推薦過程都有詳細的進度顯示：

**比對進度步驟**：
- 10% - 檢查檔案設定...
- 20% - 載入錯誤碼檔案...
- 40% - 載入來源工作表...
- 60% - 載入參考資料...
- 70% - 分析資料結構...
- 80% - 執行資料比對...
- 85% - 準備儲存檔案...
- 90% - 儲存比對結果...
- 100% - 比對完成！

**AI 推薦進度步驟**：
- 載入參考資料
- 讀取比對結果檔案
- 分析描述內容
- 生成推薦結果
- 更新 Excel 檔案

## 參考資料格式說明

### Test Item Code CSV 檔案結構

參考資料 `Test Item Code V2.00_20241106_CSV.csv` 包含以下欄位：

| 欄位 | 說明 | 範例 |
|------|------|------|
| Main Function | 主要功能分類 | AFM, Audio, BOARD Measure |
| Interface | 介面類型 | Audio RCA L, Audio Jack R |
| Interenal Error Code | 內部錯誤代碼 | AFFY001, ADRL001 |
| Description | 英文描述 | AFM Frequency Fail |
| 中文描述 | 中文描述 | AFM Frequency 頻率測試失敗 |
| Version | 版本資訊 | Rev. 1.3, Rev. 2.00 |
| Error Code | 實際錯誤代碼 | BSFTUJ, E00IO000008 |
| Note | 備註 | 開發者資訊和版本說明 |

### 支援的 Error Code 格式

1. **BSF 系列**：如 `BSFTUJ`, `BSFR8L`, `BSFA04`
2. **E00 系列**：如 `E00IO000008`, `E00AT000164`, `E00FW000238`

### 功能分類

- **AFM**：AFM 功能測試
- **Audio**：音頻相關測試（RCA L/R, Jack L/R, SCART, SPDIF）
- **BOARD Measure**：板卡測量（電壓、系統、電源）
- **CA FUNCTION**：CA 功能測試
- **其他功能模組**：包含各種硬體和軟體測試項目

## AI 推薦功能說明

### 推薦邏輯
- **關鍵字匹配**：基於 Description 中的關鍵字進行匹配
- **功能分類分析**：考慮 AFM、Audio、BOARD Measure 等功能分類
- **語義理解**：支援中英文描述的語義分析
- **模糊匹配**：即使不完全匹配也能找到相關的 Test ID

### 輸出格式
AI 推薦結果會新增到比對結果檔案的 E、F 欄位：
- **E 欄位**：AI推薦 test ID 1（最匹配的推薦）
- **F 欄位**：AI推薦 test ID 2（次匹配的推薦）

### PROMPT 模板
系統提供多種 PROMPT 模板：
- **基本分析**：適用於一般 Description 分析
- **單一分析**：適用於單個 Description 的詳細分析
- **批量分析**：適用於多個 Description 的批量處理
- **Excel 整合**：適用於直接填入 Excel 欄位

## 專案結構

```
Error Code Comparer/
├── 核心程式檔案/
│   ├── main.py                          # 主程式入口
│   ├── ui_manager.py                    # GUI 介面管理
│   ├── excel_handler.py                 # Excel 檔案處理
│   ├── ai_recommendation_engine.py      # AI 推薦引擎
│   ├── ai_prompt_templates.py           # AI PROMPT 模板
│   ├── file_finder.py                   # 檔案搜尋工具
│   ├── config_manager.py                # 配置管理
│   └── excel_errorcode_search_ui.py      # 錯誤碼查詢 UI
├── 版本管理/
│   ├── VERSION.py                       # 版本配置檔案
│   ├── version_tool.py                  # 版本管理工具
│   ├── version_config.py                # 完整版本管理工具
│   ├── version_manager.py               # 進階版本管理工具
│   ├── update_version.py                # 版本更新腳本
│   └── VERSION_USAGE.md                 # 版本管理使用說明
├── 打包腳本/
│   ├── build_exe.bat                    # 完整打包腳本
│   ├── build_quick.bat                  # 快速打包腳本
│   └── build_simple.bat                 # 簡化打包腳本
├── 資源檔案/
│   ├── guide_popup/                     # GUI 引導圖片
│   │   ├── guide.py
│   │   ├── guide1.png ~ guide5.png
│   │   └── setup.txt
│   ├── EXCEL/                           # 範例 Excel 檔案
│   │   ├── Test Item Code V2.00_20241106.xlsx
│   │   ├── MU310_TestFlow_FWdownload_20250902.xlsx
│   │   └── *_compare_ERRORCODE.xlsx
│   ├── pal.ico                          # 應用程式圖示
│   ├── setup.txt                        # 配置檔案
│   └── requirements.txt                 # Python 依賴
├── 文檔檔案/
│   ├── README.md                        # 專案說明文件
│   ├── AI_RECOMMENDATION_USAGE.md       # AI 推薦功能說明
│   └── app.log                          # 應用程式日誌
├── 發佈目錄/
│   └── dist_exe/                        # 打包後的執行檔和資源
└── 備份目錄/
    └── DEL/                             # 用不到的檔案備份
```

## 版本管理

### 版本控制工具

本專案提供多種版本管理工具：

1. **VERSION.py** - 主要版本配置檔案
   - 包含版本號、建置編號、發布日期等資訊
   - 功能開關控制
   - 變更記錄管理

2. **version_tool.py** - 簡單版本管理工具
   ```bash
   # 顯示當前版本資訊
   python version_tool.py show
   
   # 設定版本號
   python version_tool.py set 1.6.0
   
   # 新增變更記錄
   python version_tool.py add "修復 AI 推薦分析問題"
   
   # 自動遞增修訂版本
   python version_tool.py bump
   ```

3. **version_config.py** - 完整版本管理工具
   - 提供互動式版本管理介面
   - 支援功能開關管理
   - 變更記錄編輯

4. **VERSION_USAGE.md** - 版本管理使用說明
   - 詳細的使用指南
   - 最佳實踐建議
   - 範例工作流程

### 變更記錄

#### v1.5.0 (2025-01-22) - 最新版本
**新增功能：**
- ✅ **狀態列顯示**：主 GUI 底部新增即時狀態顯示，支援進度提示和錯誤訊息
- ✅ **進度條功能**：比對和 AI 推薦過程都有詳細的進度條和步驟顯示
- ✅ **覆蓋檔案選項**：新增 Checkbox 控制是否覆蓋現有比對檔案，預設打勾
- ✅ **檔案記憶功能**：自動記住上次使用的檔案路徑，下次啟動時自動載入
- ✅ **錯誤碼查詢優化**：修復 logger 未定義錯誤，改善檔案讀取穩定性
- ✅ **智能標題行檢測**：自動處理 Excel 檔案的標題行，避免 "Unnamed" 欄位問題
- ✅ **AI 推薦流程優化**：自動檢查並執行比對，無需手動操作
- ✅ **Excel 格式保持**：AI 推薦後完全保持原有 Excel 格式，不影響原有內容
- ✅ **專案結構優化**：移動用不到的檔案到 DEL 目錄，保持專案整潔
- ✅ **EXE 打包優化**：移除多餘的 build_exe 目錄，簡化打包流程

**修復問題：**
- 🔧 修復錯誤碼查詢的 logger 未定義錯誤
- 🔧 修復 Excel 檔案讀取的 "Unnamed" 欄位問題
- 🔧 修復 AI 推薦完成後 Excel 檔案空白問題
- 🔧 修復 AI 推薦後 Excel 格式亂掉問題
- 🔧 修復檔案搜尋重複問題
- 🔧 修復比對和 AI 推薦的彈出視窗問題
- 🔧 優化狀態列顯示邏輯

**技術改進：**
- 📈 提升 AI 推薦成功率至 66.7%
- 📈 改善用戶體驗，減少手動操作
- 📈 優化記憶體使用和檔案處理效率
- 📈 增強錯誤處理和日誌記錄
- 📈 使用 openpyxl 直接操作保持 Excel 格式
- 📈 實現備份機制確保檔案安全

#### v1.4.x (歷史版本)
- 初始版本 1.5.0
- 新增 AI 推薦分析功能
- 新增自動檔案選擇功能
- 新增智能工作表過濾功能
- 新增快速開啟結果檔案功能
- 修復檔案搜尋重複問題
- 優化 GUI 用戶體驗
- 新增版本管理系統

## 注意事項

### 系統要求
- **作業系統**：Windows 10/11
- **Python 環境**：Python 3.8+（開發環境）
- **依賴套件**：pandas, openpyxl, tkinter, ttkbootstrap
- **記憶體**：建議 4GB 以上
- **磁碟空間**：至少 500MB 可用空間

### 檔案要求
- **Error Code 參考檔案**：必須包含 "Test Item All" 工作表
- **源 Excel 檔案**：必須包含 Description 欄位（O 欄位）
- **檔案格式**：支援 .xlsx 和 .xls 格式
- **檔案編碼**：建議使用 UTF-8 編碼

### 使用建議
- **定期備份**：建議定期備份重要的 Excel 檔案
- **檔案命名**：使用有意義的檔案名稱，避免特殊字符
- **狀態監控**：注意狀態列的提示訊息，及時處理錯誤
- **進度追蹤**：利用進度條了解操作進度，避免重複操作
- **覆蓋選項**：使用覆蓋檔案選項避免重複確認對話框
- **版本管理**：使用版本管理工具記錄重要變更
- **AI 推薦**：AI 推薦功能需要先完成基本比對，或手動處理 PROMPT
- **格式保持**：AI 推薦會完全保持原有 Excel 格式，可放心使用

### 故障排除
- **檔案讀取失敗**：檢查檔案是否被其他程式佔用
- **AI 推薦空白**：確認比對結果檔案存在且格式正確
- **AI 推薦格式亂掉**：已修復，使用備份機制確保格式保持
- **狀態列異常**：重啟程式或檢查日誌檔案
- **進度條卡住**：檢查檔案路徑和權限，重啟程式
- **覆蓋選項無效**：確認 Checkbox 狀態，重新勾選
- **打包失敗**：確認 PyInstaller 已正確安裝

## 打包和部署

### 打包腳本說明

本專案提供三種打包腳本：

1. **build_exe.bat** - 完整打包腳本
   - 包含所有資源檔案和文檔
   - 自動清理臨時檔案
   - 適合正式發布

2. **build_quick.bat** - 快速打包腳本
   - 只包含必要檔案
   - 適合開發測試
   - 打包速度最快

3. **build_simple.bat** - 簡化打包腳本
   - 基本打包功能
   - 適合簡單部署

### 打包流程優化

- ✅ **移除多餘目錄**：不再產生 build_exe 目錄
- ✅ **自動清理**：自動清理 PyInstaller 臨時檔案
- ✅ **資源整合**：所有資源檔案整合到 dist_exe 目錄
- ✅ **版本資訊**：自動生成版本資訊檔案

### 部署建議

- **單機部署**：直接複製 dist_exe 目錄到目標機器
- **網路部署**：將 dist_exe 目錄打包成 ZIP 檔案分發
- **企業部署**：建議使用 build_exe.bat 進行完整打包 